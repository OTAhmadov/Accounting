<div style="display: none; padding-right: 17px;" class="modal fade" role="dialog" aria-labelledby="gridSystemModalLabel" id="exportModal">
    <div class="modal-dialog" role="document">
        <div class="modal-content">
            <div class="row">
                <div class="col-md-12">
                    <div class="modal-pdf col-md-4">
                        <a class="export" data-value="pdf" href="#"><img class="a-export" src="assets/img/pdf-icon.png" width="150" height="150" alt="pdf"></a>
                    </div>
                    <div class="modal-excel col-md-4">
                        <a class="export"  data-value="xls" href="#"><img class="a-export" src="assets/img/excel-icon.png" width="150" height="150" alt="xls"></a>
                    </div>
                    <div class="modal-html col-md-4">
                        <a class="export" data-value="html" href="#"><img class="a-export" src="assets/img/html-icon.png" width="150" height="150" alt="html"></a>
                    </div>
                </div>
            </div>
        </div>
        <!-- /.modal-content -->
    </div>
    <!-- /.modal-dialog -->
</div>
<form class="sabah-form">
    <input name="educationPaymentTypeId" class="hidden" />
    <input name="searchAttr" class="hidden" />
</form>

<div class="content-header">
    <div class="con-head-left">
        <span data-i18n="" placeholder="Tələbələr" class="hed-title">İxtisaslar</span><span  class="head-total"> <span data-speciality-count></span></span>
    </div>
    <div class="con-head-right">
        <div class="prepend-icon">
            <input data-i18n="placeholder.search" id="student_search" type="search" placeholder="Search">

        </div>
<!--        <button  type="button" class="btn btn-default btn-student-advanced-search clear_search_button">
            <span data-i18n="advanced_search">Advanced search</span>

        </button>-->
        <div id="buttons_div" class="dropdown-func">
            <div class="btn btn-default reg dropdown-toggle cog" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" >
                Ümumi əməliyyatlar
            </div>
            <ul id="module_operations" class="dropdown-menu calibrated">
            </ul>
        </div>
    </div>
</div>

<form class="student-search-form">
    <input type="hidden" name="genderId">
    <input type="hidden" name="orgId">
    <input type="hidden" name="uniName">
    <input type="hidden" name="uniOrg">
    <input type="hidden" name="statusId">
    <input type="hidden" name="status">
    <input type="hidden" name="actionTypeId">
    <input class="hidden" name="genderName">
    <input class="hidden" name="actionName">
    <input class="hidden" name="statusName">
    <input type="hidden" name="groupId">
    <input type="hidden" name="keyword">
    <input type="hidden" name="yearId">
</form>
<div class="filters-block module_1000011">
    <div class="btn-group">
        <select class="form-control " id="org_uni_filter_for_spec" >

        </select>
    </div>
<!--    <div class="btn-group">
        <select class="form-control " id="org_faculty_filter">

        </select>
    </div>-->
   
<!--    <div class="btn-group">
        <select class="form-control " id="edu_start_year">

        </select>
    </div>-->
    
    <div class="btn btn-info btn-lg btn-group top clear_search hidden " title="Ətraflı axtarışı Təmizlə">
        <span class="glyphicon glyphicon-remove"></span>
    </div>
</div>

<div class="row">
    <div class="tab-pane fade in active data col-sm-12 profession-div">
        <div  class="panel panel-white table-scroll">

            <div class="table-responsive">

                <table id="profession_list" class="table table-celled table-hover">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th  data-sort="uni_org_az" class="asc"><span data-i18n="spec_name">Org name</span> <i class="fa fa-sort-asc" aria-hidden="true"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
            </div>        
<!--            <div class="space-for-footer">
                <div id="load_more_div" class="flex-input">
                    <button  data-i18n="load.more" data-table="professions" class="btn loading-margins btn-load-more">Load more</button>
                </div>
            </div>-->

        </div>
    </div>
        <div class="col-sm-6 info prof-info">
        <div class="panel panel-white">
            <div class="panel-heading">
                <h3 data-i18n="info" class="panel-title" placeholder="Məlumat">Məlumat</h3>
                <div class="panel-close"><img src="assets/img/upd/close.svg" alt=""></div>
                <div class="type_2_btns"><div title="Əməliyyatlar" class="operations operations-top dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><img src="assets/img/upd/table-dots.svg"></div><ul class="dropdown-menu"><li><a id="operation_1000042" data-status="undefined" href="#">Təsdiq et</a></li><li><a id="operation_1000076" data-status="undefined" href="#">Şəxsi məlumatların redaktəsi</a></li><li><a id="operation_1000058" data-status="undefined" href="#">Əməkdaşa baxış</a></li><li><a id="operation_1000032" data-status="undefined" href="#">Əməkdaşın redaktəsi</a></li><li><a id="operation_1000033" data-status="undefined" href="#">Əməkdaşın silinməsi</a></li></ul></div>
            </div>
            <div class="panel-body">
                <div class="col-xs-12 info-item prof-name">
                    <table id="profession_detail_list" class="table table-celled table-hover">
                    <thead>
                        <tr>
                            <th>№</th>
                            <th  data-sort="uni_org_az" class="asc"><span data-i18n="">Məbləğ</span> <i class="fa fa-sort-asc" aria-hidden="true"></i></th>
                            <th  data-sort="uni_org_az" class="asc"><span data-i18n="">Başlanğıc tarixi</span> <i class="fa fa-sort-asc" aria-hidden="true"></i></th>
                            <th  data-sort="uni_org_az" class="asc"><span data-i18n="">Bitiş tarixi</span> <i class="fa fa-sort-asc" aria-hidden="true"></i></th>
                        </tr>
                    </thead>
                    <tbody>
                    </tbody>
                </table>
                </div>
            </div>
        </div>
    </div>
</div>

<!--tree modal-->
<div class="modal tree-modal">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header header-primary">
                <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                <h4 data-i18n="structure" class="modal-title">Structures</h4>
            </div>
            <div class="modal-body scrollable">
                <div class="row">
                    <div class="col-xs-12">
                        <div class="search-bar">
                            <div class="prepend-icon">
                                <input data-i18n="placeholder.search" class="form-control input-sm tree-search" type="search" placeholder="Search">
                                <i class="fa fa-search"></i>
                            </div>
                        </div>
                        <div id="structures-tree" style="overflow: auto;">

                        </div>
                    </div>
                </div>
            </div>
            <div class="modal-footer flex-img">
                <button data-i18n="ok" type="button" class="btn btn-primary orgStructureFilter">OK</button>
            </div>
        </div>
    </div>
</div>

<div class="new-upd">
    <div class="search-scroll">
        <div class="text-right">
            <button data-i18n="close" type="submit" class="btn btn-primary btn-block new-close ">CLose</button>
        </div>
        <h2 data-i18n="search_student" class="panel-title">Search student</h2>

        <div class="pincode-div-first">
            <label data-i18n="pincode">Pincode</label>
            <input class="search-pincode" type="text" placeholder="#########"/>
        </div>
        <div class="pincode-div-second hidden">
            <div class="row">
                <div class="col-md-6 col-sm-6 col-lg-6">
                    <div><label data-i18n="pincode" >Pincode:</label> &nbsp;<b><label class="pincode"></label></b></div>
                    <div><label class="pincode-label"></label></div>

                </div>
                <div class="col-md-6 col-sm-6 col-lg-6 iamas-search hidden">
                    <div class="form-group">
                        <div class="radio">
                            <label>
                                <input name="form-field-radio2" class="check-iamas-input" checked="checked" type="checkbox">
                                <span data-i18n="iamas" class="text">IAMAS </span>
                            </label>
                        </div>
                        <div class="radio" >
                            <label>
                                <input name="form-field-radio2"  type="checkbox" disabled="disabled">
                                <span data-i18n="myi" class="text">Müvəqqəti Yaşayış İcazəsi - Seriya</span>
                            </label>
                        </div>
                    </div>
                </div>

            </div>

        </div>

        <div class="row">
            <div class="col-md-6">
                <button data-i18n="back" type="submit" class="btn btn-primary btn-block pincode-button-back hidden">Back</button>
            </div>
            <div class="col-md-6">
                <button data-i18n="next" type="submit" class="btn btn-primary btn-block pincode-button-next">Next</button>
            </div>
        </div>


    </div>
</div>
<div class="add-new">
    <div class="search-scroll"></div>
</div>

<script src="assets/js/modal_drag.js"></script>
<script src="assets/js/jquery-ui.js"></script>
<script>
    $(function () {
        Accounting.i18n(Accounting.lang);
        $('body').find('#org_uni_filter_for_spec').select2();
        $('body').find('.table-scroll').slimScroll();
        $('.search-scroll').slimScroll();
        $('body').on('click', '.new-close', function () {
            $('body').find('.new-upd').css('right', '-100%');
        });
        if (sessionStorage.studentSearch != undefined) {
            $('.clear_search').removeClass('hidden');
        }
        $('#edu_levels').select2({
            placeholder: Accounting.dictionary[Accounting.lang]["edu_level"],
            language: {
                noResults: function () {
                    return Accounting.dictionary[Accounting.lang]["no_information"];
                }
            }
        });
        $('#groups').select2({
            placeholder: Accounting.dictionary[Accounting.lang]["academic_groups"],
            language: {
                noResults: function () {
                    return Accounting.dictionary[Accounting.lang]["no_information"];
                }
            }
        });

        $('#edu_levels').on('select2:select', function (evt) {
            var arr = $(this).val();
            var last = evt.params.data.id;
            if (last > 0) {
                Accounting.subModuleId.push(last);
                var orgId = $('.student-search-form input[name="orgId"]').val();
                var eduTypesSelect = $('input[type="checkbox"][type-id="1000015"]');
                var eduTypes = [];
                eduTypesSelect.each(function (i, v) {
                    if (v.value.length > 0) {
                        if (v.value == '1000102') {
                            eduTypes.push(1000186);
                        }
                        else if (v.value == '1000103') {
                            eduTypes.push(1000140);
                        }
                    }
                });
                var groupParams = '&orgId=' + orgId + '&eduLevels=' + arr + '&eduTypes=' + eduTypes;
                Accounting.Proxy.getAcademicGroupForSelect(groupParams, function (groups) {
                    if (groups) {
                        var html = '<option value="">' + Accounting.dictionary[Accounting.lang]["select"] + '</option>' +
                                '<option value="1">Qrupa daxil olmayanlar</option>';
                        $.each(groups, function (i, v) {
                            html += '<option value="' + v.id + '">' + v.name[Accounting.lang] + '</option>';
                        });
                        $('#groups').html(html);
                    }
                });
                var queryparams = $('.main-content-upd .student-search-form').serialize();
                Accounting.Proxy.loadStudents('', queryparams);
            }
        });

        $('#edu_levels').on('change', function (e) {
            var uldiv = $(this).siblings('span.select2').find('ul');
            var count = uldiv.find('li').length - 1;
            uldiv.html('<li class="modified">' + Accounting.dictionary[Accounting.lang]["selected_count"] + ": " + count + "</li>");
        });

        $('#edu_levels').on('select2:unselecting', function (e) {
            var arr = $(this).val();
            var val = e.params.args.data.id;
            arr = jQuery.grep(arr, function (value) {
                return value != val;
            });
            var orgId = $('.student-search-form input[name="orgId"]').val();
            var eduTypesSelect = $('input[type="checkbox"][type-id="1000015"]');
            var eduTypes = [];
            eduTypesSelect.each(function (i, v) {
                if (v.value.length > 0) {
                    if (v.value == '1000102') {
                        eduTypes.push(1000186);
                    }
                    else if (v.value == '1000103') {
                        eduTypes.push(1000140);
                    }
                }
            });
            var groupParams = '&orgId=' + orgId + '&eduLevels=' + arr + '&eduTypes=' + eduTypes;
            Accounting.Proxy.getAcademicGroupForSelect(groupParams, function (groups) {
                if (groups) {
                    var html = '<option value="">' + Accounting.dictionary[Accounting.lang]["select"] + '</option>' +
                            '<option value="1">Qrupa daxil olmayanlar</option>';
                    $.each(groups, function (i, v) {
                        html += '<option value="' + v.id + '">' + v.name[Accounting.lang] + '</option>';
                    });
                    $('#groups').html(html);
                }
            });

            Accounting.subModuleId = jQuery.grep(Accounting.subModuleId, function (value) {
                return value != val;
            });
            var queryparams = $('.main-content-upd .student-search-form').serialize();
            Accounting.Proxy.loadStudents('', queryparams);
        });

        $('.tree-modal .modal-content').draggable({
            cancel: '.scrollable'
        });

        Accounting.Proxy.loadOperations(Accounting.currModule, function (operations) {
            $('body').find('.type_2_btns ul').html(Accounting.Service.parseOperations(operations, 1));

        });

        $('#main-div .sub_modules_div').remove();
        $('.module-list').find('.sub-module-con').remove();

        Accounting.Proxy.loadStudents('', '', function () {

            Accounting.Proxy.loadDictionariesByTypeId(1000044, 0, function (status) {
                var html = "<li data-id = '0'><a href='#'>" + Accounting.dictionary[Accounting.lang]['all'] + "</a></li>";
                $.each(status, function (i, v) {
                    html += '<li data-id = "' + v.id + '"><a href="#">' + v.value[Accounting.lang] + '</a></li>'
                });
                $('.student-status').html(html);
            });


            Accounting.Proxy.loadDictionariesByTypeId('1000003', 0, function (gender) {
                var html = "<li data-id = '0'><a href='#'>" + Accounting.dictionary[Accounting.lang]['all'] + "</a></li>";
                $.each(gender, function (i, v) {
                    html += '<li data-id = "' + v.id + '"><a href="#">' + v.value[Accounting.lang] + '</a></li>'
                });
                $('.student-gender').html(html);
            });


            Accounting.Proxy.loadDictionariesByTypeId(1000037, 0, function (actionType) {
                var html = "<li data-id = '0'><a href='#'>" + Accounting.dictionary[Accounting.lang]['select'] + "</a></li>";
                $.each(actionType, function (i, v) {
                    html += '<li data-id = "' + v.id + '"><a href="#">' + v.value[Accounting.lang] + '</a></li>'
                });
                $('.student-action-type').html(html);
                var subhtml = "<li data-id = '0'><a href='#'>" + Accounting.dictionary[Accounting.lang]['active_students'] + "</a></li>";
                $('.student-sub-action-type').html(subhtml);

            });

        });

        Accounting.Proxy.getAcademicGroupForSelect('', function (groups) {
            if (groups) {
                var html = '<option value="">' + Accounting.dictionary[Accounting.lang]["select"] + '</option>' +
                        '<option value="1">Qrupa daxil olmayanlar</option>';
                $.each(groups, function (i, v) {
                    html += '<option value="' + v.id + '">' + v.name[Accounting.lang] + '</option>';
                });
                $('#groups').html(html);
            }
        });

        Accounting.Proxy.loadDictionariesByTypeId(1000016, 0, function (eduLevels) {
            if (eduLevels) {
                var html = '';
                $.each(eduLevels, function (i, v) {
                    html += '<option value="' + v.id + '">' + v.value[Accounting.lang] + '</option>';
                });
                $('#edu_levels').html(html);

            }
        });
        
        Accounting.Proxy.loadDictionariesByTypeId('1000002', 1000700, function (eduLevel) {
            if(eduLevel) {
                var html = '<option value="0">İxtisas səviyyəsi</option>';
                $.each(eduLevel, function (i, v) {
                    html += '<option parent="' + v.parentId + '" code="' + v.code + '" value="' + v.id + '">' + v.value[Accounting.lang] + '</option>';
                });
                $('#main-div #org_spec_level_filter').html(html);
            }
                
        });
        
        Accounting.Proxy.getStructureListByFilter(0, 0,function(data) {
            $("#org_uni_filter_for_spec option:eq(4)").attr("selected","selected");
            if(data && data.data) {
                var html = '';
                var uni = data.data.universityList;
                var faculty = data.data.facultyList;
                var spec = data.data.specialityList;
                var uniCount = data.data.universityList.length;
                var facultyCount = data.data.facultyList.length;
                var specCount = data.data.specialityList.length;
               
                if(uniCount <= 1) {
                    $('#org_uni_filter_for_spec').attr('disabled', 'disabled')
                    $.each(uni, function(i, v){
                        
                        html += '<option value = "'+v.id+'">'+v.name[Accounting.lang]+'</option>'
                    })
                    $('#org_uni_filter_for_spec').html(html)
                } else {
                    html = ''
                    $.each(uni, function(i, v){
                        if(i === 0) {
                            html += '<option value = "'+v.id+'" selected>'+v.name[Accounting.lang]+'</option>'
                        } else {
                            html += '<option value = "'+v.id+'">'+v.name[Accounting.lang]+'</option>'
                        }
                        
                    })
                    $('#org_uni_filter_for_spec').html(html)
                }
                $("#org_uni_filter_for_spec").trigger("change");
                
                if(facultyCount <= 1) {
                    html = '';
                    $('#org_faculty_filter').attr('disabled', 'disabled')
                    $('#org_faculty_filter').html(html)
                }else {
                    html = '<option value = "0">Fakültə</option>'
                    $('#org_faculty_filter').html(html)
                }
                if(specCount <= 1) {
                    html = '';
                    $('#org_spec_filter').attr('disabled', 'disabled')
                    $('#org_spec_filter').html(html)
                } else {
                    html = '<option value = "0">İxtisas</option>'
                    $('#org_spec_filter').html(html)
                }
            }
            
        });

//        $('#org_uni_filter').on('change', function () {
//            
//            var id = $(this).val();
//            var text = $(this).find('option:selected').text();
//            var levelId = $('#org_spec_level_filter').val();
//            
//            Accounting.Proxy.getStructureListByFilter(id, levelId, function (data) {
//                if (data && data.data) {
//                    var html = '';
//                    var spec = data.data.specialityList;
//                    var specialityCount = spec.length;
//                    var count = $('#profession_list tbody tr').length;
//                    if(specialityCount > 0){
//                        $('span[data-speciality-count]').html(specialityCount);
//                    }
//                    $.each(spec, function (i, v) {
//                        html += '<tr data-id="' + v.id + '" data-spec-name="' + v.name[Accounting.lang] +'">' +
//                                '<td>' + (++count) + '</td>' +
//                                '<td>' + v.name[Accounting.lang] + '</td>' +
//                                '<td></td>' +
//                                '</tr>'
//                    })
//                    $('#profession_list tbody').html(html)
//
//                    if (id != 1000001 || id != 0) {
//                        $('.main-content-upd .student-search-form input[name="orgId"]').val(id);
//                        $('.main-content-upd .student-search-form input[name="uniOrg"]').val(id);
//                        $('.main-content-upd .student-search-form input[name="uniName"]').val(text);
//                    } else {
//                        $('.main-content-upd .student-search-form input[name="orgId"]').val('');
//                        $('.main-content-upd .student-search-form input[name="uniOrg"]').val('');
//                        $('.main-content-upd .student-search-form input[name="uniName"]').val('');
//                    }
//
//                    $('.btn-load-more').removeAttr('data-page');
//                    var queryparams = $('.main-content-upd .student-search-form').serialize();
//                    Accounting.Proxy.loadStudents('', queryparams);
//
//                }
//            })
//
//        });

        $(".tree-search").keyup(function () {
            var searchString = $(this).val();
            $('#structures-tree').jstree('search', searchString);
        });

        $('.orgStructureFilter').on('click', function (e) {
            try {
                var id = $('#structures-tree li[aria-selected="true"]').attr('id');
                var text = $('#structures-tree li[aria-selected="true"]').find('a:first').text();
                if (text.length > 0) {
                    $('.btn.tree-modal').text(text);
                    $('.btn.tree-modal').attr('data-id', id);
                    if (window.matchMedia('(min-width: 1300px)').matches) {
                        var length = $('.tree-modal.btb-group').width();
                        if (length > 442) {
                            $('.btn-group.top').addClass('m-t-5');
                        }
                        else {
                            $('.btn-group.top').removeClass('m-t-5');
                        }
                    }
                    if (id != 1000001) {
                        $('.main-content-upd .student-search-form input[name="orgId"]').val(id);
                        $('.main-content-upd .student-search-form input[name="uniOrg"]').val(id);
                        $('.main-content-upd .student-search-form input[name="uniName"]').val(text);
                    }
                    else {
                        $('.main-content-upd .student-search-form input[name="orgId"]').val('');
                        $('.main-content-upd .student-search-form input[name="uniOrg"]').val('');
                        $('.main-content-upd .student-search-form input[name="uniName"]').val('');
                    }
                    $('.btn-load-more').removeAttr('data-page');
                    var queryparams = $('.main-content-upd .student-search-form').serialize();
                    Accounting.Proxy.loadStudents('', queryparams);
                    $('.modal.tree-modal').modal('hide');
                }
                else {
                    $.notify(Accounting.dictionary[Accounting.lang]['select_information'], {
                        type: 'warning'
                    })
                }

            }
            catch (err) {

            }


        });
        $('.modal-content').draggable();

        $('.datepicker').datepicker();

        Accounting.Proxy.getEduYears(function (years) {
            if (years) {
                var html = '<option value="0">Tədris ili</option>';
                $.each(years, function (i, v) {
                    html += '<option value="' + v.id + '">' + v.value[Accounting.lang] + '</option>';
                });
                $('#edu_start_year').html(html);
            }
        });

        $('#main-div').on('change', '#edu_start_year', function (e) {
            try {
                var yearId = $(this).find('option:selected').val();
                var actionType = $('.student-search-form [name="actionTypeId"]').val();
                if (actionType == '1000260') {
                    $('.student-search-form [name="yearId"]').val(yearId);
                    var params = $('.student-search-form').serialize();
                    Accounting.Proxy.loadStudents('', params);
                }
                else {
                    $('.student-search-form [name="yearId"]').val('');
                }

            }
            catch (err) {
                console.error(err);
            }

        });

        $('body').on('click', '.student-action-type li', function () {
            try {
                var id = $(this).attr('data-id');
                var html = "";
                if (id == 0) {
                    html += "<li data-id = '0'><a href='#'>" + Accounting.dictionary[Accounting.lang]['active_students'] + "</a></li>";
                    $('.student-sub-action-type').html(html);
                }
                else {
                    Accounting.Proxy.loadDictionariesByTypeId(1000025, id, function (actionType) {
                        $.each(actionType, function (i, v) {
                            html += '<li data-id = "' + v.id + '"><a href="#">' + v.value[Accounting.lang] + '</a></li>'
                        });
                        $('.student-sub-action-type').html(html);
                    });
                }
                $('.student-sub-action-type').siblings('button').find('span').text(Accounting.dictionary[Accounting.lang]['sub_action_type']);
            }
            catch (err) {
                console.error(err)
            }
        });


        $('#main-div').on('click', '.clear_search', function (e) {
            if (sessionStorage.studentSearch != undefined) {
                sessionStorage.removeItem('studentSearch');
                $(this).addClass('hidden');
                var params = $('.student-search-form').serialize();
                Accounting.Proxy.loadStudents('', params);
            }
        });
        
//        Accounting.Proxy.getProfessions(function(data) {
//            if(data){
//                var count = $('#profession_list tbody tr').length;
//                var result = data.data
//                var b = ''
//                    $.each(result, function (i, v) {
//                        b += '<tr data-id="' + v.id + '" data-spec-name="' + v.name[Accounting.lang] +'">' +
//                                '<td>' + (++count) + '</td>' +
//                                '<td>' + v.name[Accounting.lang] + '</td>' +
//                                '<td></td>' +
//                                '</tr>'
//
//                        })
//                        $('body').find('#profession_list tbody').append(b);
//                    }
//                });
    });
    
</script>
